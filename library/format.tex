
\section{Format}

Format is a pretty printer library. 

\begin{ocamlcode}
  open_box 0; print_string "x ="; print_space ();
  print_int 1; close_box (); print_newline ()
  (** equivalent *)

  printf "@[x =@ %i@]@." 1.
\end{ocamlcode}

In case of interactive use, the system closes all opened boxes and
flushes all pending text (as with the print\_newline function) after
each phrase. Each phrase is therefore executed in the initial state of
the pretty-printer.

The material output by the following functions is delayed in the
pretty-printer queue in order to compute the proper line
breaking. Hence, you \textit{should not mix} calls to the printing
functions of the basic I/O system with calls to the functions of this
module: this could result in some strange output seemingly unrelated
with the evaluation order of printing commands.

Some important APIs:


\textit{open\_box d} opens a new pretty-printing box with
\textit{offset d}. This box is the general purpose pretty-printing
box. Material in this box is displayed \textit{horizontal or
  vertical}; break hints inside the box may lead to a new line, if
there is no more room on the line to print the remainder of the box,
or if a new line may lead to a new indentation (demonstrating the
indentation of the box). When a new line is printed in the box,
\textit{d is added} to the current indentation.

\textit{print\_as len str} prints str in the current box. The
\textit{pretty-printer} formats str as if it were of length len

\textit{print\_space ()} is used to separate items (typically to print
a space between two words). It indicates that the line may be split at
this point. It either prints one space or splits the line. It is
equivalent to \textit{print\_break 1 0}.

\textit{print\_cut () }is used to mark a good break position. It
indicates that the line may be split at this point. It either prints
nothing or splits the line. This allows line splitting at the current
point, without printing spaces or adding indentation. It is equivalent
to \textit{print\_break 0 0}.

Inserts a break hint in a pretty-printing box. \textit{print\_break nspaces
offset} indicates that the line may be split (a newline character is
printed) at this point, if the contents of the current box does not
fit on the current line. If the line is split at that point, offset is
added to the current indentation. If the line is not split, nspaces
spaces are printed.


Boxes, Break hints, and Indentation rules.

\subsection{Indentation Rules}
\label{sec:indentation-rules}

A box can state \textit{the extra indentation of every new line} opened in its
scope. This extra indentation is named box breaking indentation.

A break hint can also set the additional indentation of the new line
it may fire. This extra indentation is named \textit{hint breaking
  indentation}.

If break hint bh fires a new line within box b, then the indentation
of the new line is simply the sum of: the current indentation of box b
+ the additional box breaking indentation, as defined by box b + the
additional hint breaking indentation, as defined by break hint bh.

\subsection{Boxes}
\label{sec:boxes}

\textit{h box}, within this box, break hints do not lead to line
breaks.

\textit{v box}, within this box, every break hint leads to a new line.

\textit{hv box}, if it is possible, the entire box is written on a
single line; otherwise, every break hint within the box leads to a new
line.

\textit{hov box}. within this box, break hints are used to cut the
line when there is no more room on the line.


Suppose we can write 10 chars before the right margin (that indicates
no more room). We represent any char as a - sign; characters [ and ]
indicates the opening and closing of a box and b stands for a break
hint given to the pretty-printing engine.

The output ``--b--b--'' is displayed like this (the b symbol stands
for the value of the break that is explained below):

within a ``h'' box: --b--b--

within a ``v'' box: \\
--b \\
--b \\
--   \\
   
within a ``hv'' box: If there is enough room to print the box on the
line: --b--b--
But ``---b---b---'' that cannot fit on the line is written \\
---b \\
---b \\
--- \\

within a ``hov'' box:
If there is enough room to print the box on the line:
   --b--b--
But if ``---b---b---'' cannot fit on the line, it is written as \\
   ---b---b \\
   --- \\

Break hints are also used to output spaces. You output a break hint
using \textit{print\_break} sp indent, and this \textit{sp} integer is used to print
``sp'' spaces. Thus \textit{print\_break sp ... }may be thought as: \textit{print sp
  spaces or output a new line}.


For instance, if b is break 1 0 in the output ``--b--b--'', we get
within a ``h'' box:
   -- -- --
within a ``v'' box:
   -- \\
   -- \\
   -- \\
within a ``hv'' box:
   -- -- -- \\
or, according to the remaining room on the line:
   -- \\ 
   -- \\ 
   -- \\ 
and similarly for ``hov'' boxes.

\subsection{Directives}
\label{sec:directives}
\begin{itemize}
\item ``@ '' outputs a breakable space (\textit{print\_space ()})

\item ``\@,''  output a break hiint (\textit{print\_cut ()})

\item ``@;<n m>'' emit a ``full'' break hint (\textit{print\_break n m})

\item ``@.'' end the pretty-printing, closing all the boxes still opened
(\textit{print\_newline ()})

\item ``@[<hov n>'' is equivalent to \textit{open\_hovbox n}.
\end{itemize}
\subsection{Example: Print }
\label{sec:example:-print-}

\inputminted[fontsize=\scriptsize
]{ocaml}{code/format/lambda.ml}
\captionof{listing}{Format  \label{Format}}



% ``\@\[``
%  open a box (open_box 0). You may precise the type as an extra
%   argument. For instance @[<hov n> is equivalent to open_hovbox n.


% ``\@\]'' close a box (close_box ()).


% ``\@ `` output a breakable space (print_space ()).
% ``@,'' output a break hint (print_cut ()).
% ``\@;<n m>'' emit a "full‚Äù break hint (print_break n m).
% ``\@.'' end the pretty-printing, closing all the boxes still opened
%   (print_newline ()).flush 

